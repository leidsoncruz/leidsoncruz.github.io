<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8" />

  
  <title>Web Components with Redux</title>

  
  
  <link href="//cdn.jsdelivr.net" rel="dns-prefetch">
  <link href="//cdnjs.cloudflare.com" rel="dns-prefetch">
  
  <link href="//at.alicdn.com" rel="dns-prefetch">
  
  <link href="//fonts.googleapis.com" rel="dns-prefetch">
  <link href="//fonts.gstatic.com" rel="dns-prefetch">
  
  
  
  <link href="//www.google-analytics.com" rel="dns-prefetch">
  

  

  
  
  <meta name="description" content="You need use Web Components in the your application? No you don’t need. I’am totally against from the hype. You should use if only you need. I see some advantages to use if you really need. For example: componentization and your advantages, very small final bundle size and etc.
In the article I talk about a project we(My team) started at globo.com. The project was build Stories like Instagram. We use ZuckJS for a POC(proof of concept) but we need customize a lot this lib. Was very expensive cost to customize, so i start wrote a Vanilla Javascript Lib and after I transform it to Web Components. You can see here the vanilla version — branch master.
">

  
  
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@gohugoio">
    <meta name="twitter:title" content="Web Components with Redux">
    <meta name="twitter:description" content="You need use Web Components in the your application? No you don’t need. I’am totally against from the hype. You should use if only you need. I see some advantages to use if you really need. For example: componentization and your advantages, very small final bundle size and etc.
In the article I talk about a project we(My team) started at globo.com. The project was build Stories like Instagram. We use ZuckJS for a POC(proof of concept) but we need customize a lot this lib. Was very expensive cost to customize, so i start wrote a Vanilla Javascript Lib and after I transform it to Web Components. You can see here the vanilla version — branch master.
">
    <meta name="twitter:image" content="/images/avatar.jpg">
  

  
  <meta property="og:type" content="article">
  <meta property="og:title" content="Web Components with Redux">
  <meta property="og:description" content="You need use Web Components in the your application? No you don’t need. I’am totally against from the hype. You should use if only you need. I see some advantages to use if you really need. For example: componentization and your advantages, very small final bundle size and etc.
In the article I talk about a project we(My team) started at globo.com. The project was build Stories like Instagram. We use ZuckJS for a POC(proof of concept) but we need customize a lot this lib. Was very expensive cost to customize, so i start wrote a Vanilla Javascript Lib and after I transform it to Web Components. You can see here the vanilla version — branch master.
">
  <meta property="og:url" content="https://leidson.com/post/web-components-with-redux/">
  <meta property="og:image" content="/images/avatar.jpg">




<meta name="generator" content="Hugo 0.55.6">


<link rel="canonical" href="https://leidson.com/post/web-components-with-redux/">

<meta name="renderer" content="webkit">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="format-detection" content="telephone=no,email=no,adress=no">
<meta http-equiv="Cache-Control" content="no-transform">


<meta name="robots" content="index,follow">
<meta name="referrer" content="origin-when-cross-origin">







<meta name="theme-color" content="#02b875">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="Leidson Cruz">
<meta name="msapplication-tooltip" content="Leidson Cruz">
<meta name='msapplication-navbutton-color' content="#02b875">
<meta name="msapplication-TileColor" content="#02b875">
<meta name="msapplication-TileImage" content="/icons/icon-144x144.png">
<link rel="icon" href="https://leidson.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://leidson.com/icons/icon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://leidson.com/icons/icon-32x32.png">
<link rel="icon" sizes="192x192" href="https://leidson.com/icons/icon-192x192.png">
<link rel="apple-touch-icon" href="https://leidson.com/icons/icon-152x152.png">
<link rel="manifest" href="https://leidson.com/manifest.json">


<link rel="preload" href="https://leidson.com/styles/main-rendered.min.css" as="style">


<link rel="preload" href="https://fonts.googleapis.com/css?family=Lobster" as="style">
<link rel="preload" href="https://leidson.com/images/avatar.jpg" as="image">
<link rel="preload" href="https://leidson.com/images/grey-prism.svg" as="image">


<style>
  body {
    background: rgb(244, 243, 241) url('/images/grey-prism.svg') repeat fixed;
  }
</style>
<link rel="stylesheet" href="https://leidson.com/styles/main-rendered.min.css">


<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lobster">



<script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.2/dist/medium-zoom.min.js"></script>




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/video.js@7.3.0/dist/video-js.min.css">



  
  
<!--[if lte IE 8]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/videojs-ie8@1.1.2/dist/videojs-ie8.min.js"></script>
<![endif]-->

<!--[if lte IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/eligrey-classlist-js-polyfill@1.2.20180112/classList.min.js"></script>
<![endif]-->


</head>
  <body>
    <div class="suspension">
      <a role="button" aria-label="Go to top" title="Go to top" class="to-top is-hide"><span class="icon icon-up" aria-hidden="true"></span></a>
      
        
      
    </div>
    
    
  <header class="site-header">
  <img class="avatar" src="https://leidson.com/images/avatar.jpg" alt="Avatar">
  
  <h2 class="title"><a style="opacity:1;" href="https://leidson.com/">Leidson Cruz</a></h2>
  
  <p class="subtitle">~ Software Engineer ~</p>
  <button class="menu-toggle" type="button" aria-label="Main Menu" aria-expanded="false" tab-index="0">
    <span class="icon icon-menu" aria-hidden="true"></span>
  </button>

  <nav class="site-menu collapsed">
    <h2 class="offscreen">Main Menu</h2>
    <ul class="menu-list">
      
      
      
      
        <li class="menu-item
          
          
          ">
          <a href="https://leidson.com/post/">Posts</a>
        </li>
      
        <li class="menu-item
          
          
          ">
          <a href="https://leidson.com/tags/">Tags</a>
        </li>
      
    </ul>
  </nav>
  <nav class="social-menu collapsed">
    <h2 class="offscreen">Social Networks</h2>
    <ul class="social-list"><li class="social-item">
          <a href="mailto:leidson89@gmail.com" title="Email" aria-label="Email">
            <span class="icon icon-email" aria-hidden="true"></span>
          </a>
        </li><li class="social-item">
          <a href="//github.com/leidsondias" rel="me" title="GitHub" aria-label="GitHub">
	    <span class="icon icon-github" aria-hidden="true"></span>
          </a>
        </li><li class="social-item">
          <a href="//medium.com/@leidsoncruz" rel="me" title="Medium" aria-label="Medium">
            <span class="icon icon-medium" aria-hidden="true"></span>
          </a>
        </li><li class="social-item">
          <a href="//www.linkedin.com/in/leidsondias" rel="me" title="LinkedIn" aria-label="LinkedIn">
            <span class="icon icon-linkedin" aria-hidden="true"></span>
          </a>
        </li></ul>
  </nav>
</header>

  <section class="main post-detail">
    <header class="post-header">
      <h1 class="post-title">Web Components with Redux</h1>
      <p class="post-meta">@Leidson Cruz · May 22, 2019 · 9 min read</p>
    </header>
    <article class="post-content"><p>You need use Web Components in the your application? No you don’t need. I’am totally against from the hype. You should use if only you need. I see some advantages to use if you really need. For example: componentization and your advantages, very small final bundle size and etc.</p>

<p>In the article I talk about a project we(My team) started at <a href="https://www.globo.com/">globo.com</a>. The project was build <strong>Stories</strong> like <strong>Instagram</strong>. We use <a href="https://github.com/ramon82/zuck.js/">ZuckJS</a> for a POC(proof of concept) but we need customize a lot this lib. Was very expensive cost to customize, so i start wrote a Vanilla Javascript Lib and after I transform it to Web Components. You can see <a href="https://github.com/leidsondias/storiesJSOlder">here</a> the vanilla version — branch master.</p>

<p>At first I had some troubles for share data between components. I do not want to use any plugin for help with this problem, I wanted to solve with what Web Components provides me and Vanilla Javascript.</p>

<p>If you want to go for Redux topic click <a href="#13e6">here</a>. I tell first what approaches I did use before go to use Redux.</p>

<h2 id="observing-changes-to-attributes">Observing changes to attributes</h2>

<p>The Web Components has a method called <a href="https://developers.google.com/web/fundamentals/web-components/customelements#attrchanges">observedAttribute</a>s , works this way: every time is your observed attribute change, his call an another method called as <a href="https://developers.google.com/web/fundamentals/web-components/customelements#attrchanges">attributeChangedCallback</a> . This second method has a three parameters: *name, oldValue <em>and</em> newValue*.</p>

<p>So, the first approach I did use for pass data to mine elements was set up an attribute and use <code>attributeChangedCallback</code> when have attribute changed for change the visualization:</p>

<p><script src="https://gist.github.com/leidsondias/fec20e1535c4bb832a85321f84fb08d9.js"></script><em>Example 1 — Story and Story Items component — The way what i put data on story-items component is not the better. But how i not have the instance for story-items component i need to do that.</em></p>

<p>I have an array of object called as <code>slides</code> and on my component <code>stories-story</code> I receive the object for use in another component the <code>story-items</code>. How you see, if my object <code>slides</code> is large my tag from html stay too big and too polluted. So, how you can imagine is not better way for share data between components. In my opinion, works if is for small things, on the documentation you can see an <a href="https://developers.google.com/web/fundamentals/web-components/customelements#attrchanges">example</a> of use to check if attribute is disabled or not and from according value sets another attributes on component.</p>

<h2 id="event-driven-architecture">Event-driven Architecture</h2>

<p>In <strong>event-driven architecture</strong> you send and/or listening events, for example if in <code>Component A</code>i need the data from <code>Component B</code> , my <code>Component A</code> need have two events. One for listening and another for tell <code>Component B</code> to want your data. For <code>Component B</code> is the same, needs event for listening if any component want data and another for send the data:</p>

<p><script src="https://gist.github.com/leidsondias/f8d5dc281f911a93f4819dba036db81f.js"></script><em>Example 2 — This example attached events on document because i don’t have a valid target. But on below code you will see the attachment is on components.</em></p>

<p>Try paste this in your browser console. You will see the order for execute is: *get data (ComponentA), send data(ComponentB) *and <em>receive data(ComponentA).</em></p>

<p>So my other approach was to use <strong>event-driven architecture</strong> to work with object and not need to set attributes on elements. Who started migrate to this architecture was my friend <a href="https://medium.com/@ricardo.linorj">Ricardo Lino</a>, he created a wrapper for events dispatch called as <code>EventEmitter</code> .</p>

<p>The <code>EventEmitter</code> is our wrapper for events management:</p>

<p><script src="https://gist.github.com/leidsondias/395df6eb81a303c5630955e6f3ad40d1.js"></script><em>Example 3 — Event Emitter, component to management events</em></p>

<p>The most important methods are: *on *and *dispatch. *The first is to listening what you want and the second is to dispatch what event you want.</p>

<p>Below you can see an example for component with listening and dispatch events. Is them same component from the first example (Example 1). The <code>stories-story</code> component but written really like a component and now is reusable.</p>

<p><script src="https://gist.github.com/leidsondias/f9f78b22056cc1c651152263d5d90c62.js"></script><em>Example 4 — Story component using our Event Emitter</em></p>

<p>Wow, now we have a reusable component with your responsibilities and scopes. But our mistake was try to migrate code instead of creating from start but starting with <strong>event-driven architecture</strong>. We found a lot of bugs, because the Vanilla way was based on find elements from parents or children. Also, I didn’t like needs two methods for get an object. So on our migration process we needed to close the POC and it had a high cost for close because of the bugs . And high cost is not are welcome to a POC. This way we stop the project (you can find <a href="https://github.com/leidsondias/storiesJSOlder">here</a> —branch is feature/EventEmitter).</p>

<p>I really enjoyed this challenge, write Stories with web components. So, I started again but this time using <a href="https://redux.js.org/">Redux</a> for help me with events and data.</p>

<h2 id="using-redux">Using Redux</h2>

<p>Why will use <strong>Redux</strong>? Using <strong>Redux</strong> my code became is very simple and very easy to get data an another components. With it my problems for events control is over as like bugs create by we on the migration progress (<strong>Vanilla</strong> &gt; <strong>Web Components</strong>) haha.</p>

<p>See below the same component from <em>Example 1</em>:</p>

<p><script src="https://gist.github.com/leidsondias/ad0f10258cabc9a78770f23a496c11ea.js"></script><em>Example 5 — Story Component using Redux</em></p>

<p>Now my Event Emitter have just methods for <em>subscribe</em>, <em>dispatch</em> and <em>getState</em> from <strong>Store</strong> (You can reading about Store <a href="https://redux.js.org/api/store">here</a>).</p>

<p><script src="https://gist.github.com/leidsondias/9353e41b42af08b3a5135a27511adea8.js"></script><em>Example 6 — Event Emitter with store</em></p>

<p><strong>Redux</strong> have a same idea an <strong>event-driven architecture</strong>. Dispatch one event and have another event to listening and fired some function.</p>

<p>For getting started we need configuration our <code>Store</code> . The store is a place where you have states of components and only change him through actions.</p>

<p><script src="https://gist.github.com/leidsondias/b0204f0802c2e9e9c914f3ddc3778733.js"></script><em>Example 7 — File for Store object</em></p>

<p>Our <code>Reducer</code>(In this example I merge the files but the reducer for Story it’s at another file). The **Reducer **have responsibility for tell how the application state changes from the according action send to store:</p>

<p><script src="https://gist.github.com/leidsondias/20aab8061772531322aabb1bd49d0768.js"></script><em>Example 8 — Reducer</em></p>

<p>So when we receive an action to <code>LOAD_STORIES</code> our reducer get the state from <code>reducerStories</code> and change the <code>stories</code> key with what the action send on <code>payload</code> key. For the <code>SET_ACTIVE_STORY</code> action is the same thing only changing the key, instead of <code>stories</code> is <code>activeStory</code> .</p>

<p>Below is the same component as <em>Example 1</em> but with another name. I renamed and make the component more clean and with more clear responsibility:</p>

<p><script src="https://gist.github.com/leidsondias/904e5dd006a695d53d746c02f69167e2.js"></script><em>Example 9 — Story component but with i rename to Stories</em></p>

<p>Now we have new stuffs *loadStories and connectedCallback *in our code.</p>

<p>In the first line we have the <code>loadStories</code> , the function responsibility is load the data and call action for send to store. We receive the data from params, but you can fetch in some API or from another way. The code for <code>loadStories</code> is this:</p>

<p><script src="https://gist.github.com/leidsondias/5db18c267d2fca92d9b0ac8c8242903c.js"></script><em>Example 10 — Load Stories action</em></p>

<p>You can see what <code>ACTIONS.LOAD_STORIES</code> do on our from <strong>Reducer</strong> file in the 13º line. Basically, keeps state and change the state from <code>stories</code> key for what we pass from <code>payload</code>.</p>

<p>I use the <code>connectedCallback</code> method for initialize our component. Why i use the <code>connectedCallback</code> instead of <code>constructor</code> ? Constructor is for you set up your component and initialize your state, but it is called only one time. So, if the data is dynamic it’s never change because your component was be started and will not calls the constructor again. The <code>connectedCallback</code> is called every time the element is inserted into the DOM. The documentation and the good practices recommend you use to fetch resources or rendering your component. You can found the good practices for web components <a href="https://developers.google.com/web/fundamentals/web-components/best-practices">here</a>.</p>

<p>Ok, I load my data on store now i can works with the data. Our data have an array of object. Each object is a story data. Below you can see an example for values from the stories key:</p>

<p><script src="https://gist.github.com/leidsondias/774f978e5c28918e85e9437b967f6c5c.js"></script><em>Example 11 — JSON with stories content</em></p>

<p>The <code>Stories</code> component add the <code>StoriesList.</code> And inside from this component we can get the <code>stories</code> saved on our state and make what we want. (In the our case we use a Component for render each story)</p>

<p><script src="https://gist.github.com/leidsondias/f89f27b59076682c9a3f58d9f205d657.js"></script><em>Example 12 — Stories List component, your responsibility is to be a wrapper for the story list</em></p>

<p>Now we can call <code>getState</code> from <code>EventEmitter</code> and get state from any reducer. You can see how get state in the 19º line. In 20º line we iterate the <code>stories</code> and create <strong>Story</strong> component for each data from <code>stories</code>.</p>

<p>Until now, we see how <strong>dispatch an event</strong> and <strong>get state</strong> from <strong>Redux</strong>. Missed anything? Yeah, the subscribe method for listening when the state change and fire any method. For example render every time we receiver a new data.</p>

<p><script src="https://gist.github.com/leidsondias/1782fd1147758611f2c7b69066b57b61.js"></script><em>Example 13 — Modal component, your responsibility is has slides from active story.</em></p>

<p>The <code>Modal</code> component listen if have a change for state. If has, the <code>render</code> method is execute. You can see this code on line 12º. In the <code>render</code> method we check if exist any story active. If have active story we create the <code>SlideList</code> component and append on the <code>Modal</code> component.</p>

<p>A bad point this code is you listening all events when state changes, not just when <code>activeStory</code>changes. We need to improve this code for not listening all, you can create an abstract class for control this. For now is not problem for our code but is a thing for change on next steps.</p>

<p>A good refactoring is isolate our components, we can use <strong>containers pattern</strong>.</p>

<p>But what we gain with this change? We will has a component reusable in any place without need your data provider is to be <code>Redux</code>. Also, this way is more easy to test your component, because you just need pass the fixture to it and test. Without use <strong>containers pattern</strong> we need use <code>MockStore</code> to test our components.</p>

<p>So an example how to use containers on our example:</p>

<p><script src="https://gist.github.com/leidsondias/ff40f2bbc505c473e6f56bea070a2864.js"></script><em>Example 14 — Stories component without Redux</em></p>

<p>So, now our component receive two params: *object *and the *loadStories *function. If you don’t now what <code>{ stories }</code> do, this is call the destructor you can found detail explanation <a href="https://gist.github.com/leidsondias/ff40f2bbc505c473e6f56bea070a2864">here</a>, but basically what this do is — extract the stories key from object I received on the params. And <em>loadStories</em> is the same function what we imports on the before examples. But this time we not have a connection with <strong>Redux</strong>, **Actions, Reducers **or our **Event Emitter. **This way, you only have to pass data and the function to test the component. If you want, you can pass an empty function.</p>

<p>Our container is this:</p>

<p><script src="https://gist.github.com/leidsondias/afed9535e1a6f54835ffbf104b5c48f9.js"></script><em>Example 15 — Stories container</em></p>

<p>The container has the <code>loadStories</code> action, responsibility for dispatch event to load data to store.</p>

<p>And now in the main file we call the container instead of component.</p>

<p><script src="https://gist.github.com/leidsondias/3492766ac213fd69ebf6e35bdd8da301.js"></script><em>Example 16 — main file from project</em></p>

<p>If you want, you can create the container how like class. On my case i don’t guess is necessary, so just the function resolve my problem.</p>

<p>You can follow all progress for project <a href="https://github.com/leidsondias/storiesJS">here</a> and contributed too. I’am writing slowly because I moved to another country and I have a lot to solve and take care of. But I will finish and hope in a few months.</p>

<p>I hope you have liked it and any suggestions or doubts are welcome. If you want correct my english I will like too hahaha ❤</p>

<p>The original post is <a href="https://medium.com/@leidsoncruz/web-components-with-redux-9e7c2da45602">https://medium.com/@leidsoncruz/web-components-with-redux-9e7c2da45602</a></p></article>
    <footer class="post-footer">
      
      <ul class="post-tags">
        
          <li><a href="https://leidson.com/tags/web-components"><span class="tag">Web Components</span></a></li>
        
          <li><a href="https://leidson.com/tags/javascript"><span class="tag">JavaScript</span></a></li>
        
          <li><a href="https://leidson.com/tags/redux"><span class="tag">Redux</span></a></li>
        
          <li><a href="https://leidson.com/tags/event-driven-architecture"><span class="tag">Event Driven Architecture</span></a></li>
        
      </ul>
      
      <p class="post-copyright">
        
      </p>
    </footer>
    
      
    
  </section>
  
<footer class="site-footer">
  <p>© 2017-2019 Leidson Cruz</p>
  <p>Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> with theme <a href="https://github.com/laozhu/hugo-nuo" target="_blank" rel="noopener">Nuo</a>.</p>
  
</footer>


<script src="https://cdn.jsdelivr.net/npm/smooth-scroll@15.0.0/dist/smooth-scroll.min.js"></script>



<script async src="https://cdn.jsdelivr.net/npm/video.js@7.3.0/dist/video.min.js"></script>




<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      displayMath: [['$$','$$'], ['\\[','\\]']],
      processEscapes: true,
      processEnvironments: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
      TeX: { equationNumbers: { autoNumber: "AMS" },
      extensions: ["AMSmath.js", "AMSsymbols.js"] }
    },
  });
</script>
<script type="text/x-mathjax-config">
  // Fix <code> tags after MathJax finishes running. This is a
  // hack to overcome a shortcoming of Markdown. Discussion at
  // https://github.com/mojombo/jekyll/issues/199
  MathJax.Hub.Queue(() => {
    MathJax.Hub.getAllJax().map(v => v.SourceElement().parentNode.className += ' has-jax');
  });
</script>



<script src="https://leidson.com/scripts/index.min.js"></script>

<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('\/service-worker.js').then(function() {
      console.log('[ServiceWorker] Registered');
    });
  }
</script>




<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-140735682-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







  </body>
</html>
